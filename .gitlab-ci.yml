stages:
  - build
  - deploy

# Install dependency sebelum build
before_script:
  - python3 -m pip install --upgrade pip setuptools wheel build twine

# Stage build: bikin wheel dan source tar.gz
build:
  stage: build
  script:
    - python3 -m build
  artifacts:
    paths:
      - dist/*.whl
      - dist/*.tar.gz

# Stage deploy: upload ke PyPI
deploy_pypi:
  stage: deploy
  script:
    - python3 -m twine upload --non-interactive --username __token__ --password "$PYPI_API_TOKEN" dist/*
  only:
    - main   # otomatis jalan setiap push ke branch main
